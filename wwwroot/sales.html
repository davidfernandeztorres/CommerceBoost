<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>CommerceBoost - Ventas</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Simple Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 10px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: none;
            border: none;
            font-weight: 600;
            color: #6b7280;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }

        .tab-btn.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
    </style>
</head>

<body>
    <div id="app">

        <header>
            <img src="logo-placeholder.png" alt="CommerceBoost Logo">
            <h2 style="margin-left: 20px; color: #374151;">Reportes de Ventas</h2>
        </header>

        <main>
            <div style="padding: 20px;">
                <div class="tabs">
                    <button class="tab-btn active" onclick="showTab('history')">Historial</button>
                    <button class="tab-btn" onclick="showTab('zreport')">Z de Caja</button>
                    <button class="tab-btn" onclick="showTab('monthly')">Totales Mensuales</button>
                </div>

                <!-- Tab: Historial -->
                <div id="history" class="tab-content active">
                    <div class="card">
                        <h3>Historial de Ventas</h3>
                        <table style="margin-top: 15px;">
                            <thead>
                                <tr>
                                    <th>ID VENTA</th>
                                    <th>FECHA</th>
                                    <th>TOTAL</th>
                                    <th>ITEMS</th>
                                </tr>
                            </thead>
                            <tbody id="historyBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Tab: Z de Caja -->
                <div id="zreport" class="tab-content">
                    <div class="card" style="max-width: 400px;">
                        <h3>Z de Caja (Hoy)</h3>
                        <div style="margin: 20px 0;">
                            <div class="stat-label">Total Recaudado</div>
                            <div class="stat-value" id="dailyTotal">$0.00</div>
                        </div>
                        <button onclick="calculateZ()"
                            style="padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">
                            Calcular Cierre
                        </button>
                    </div>
                </div>

                <!-- Tab: Mensual -->
                <div id="monthly" class="tab-content">
                    <div class="card">
                        <h3>Totales Mensuales</h3>
                        <table style="margin-top: 15px;">
                            <thead>
                                <tr>
                                    <th>MES</th>
                                    <th>AÃ‘O</th>
                                    <th>TOTAL</th>
                                </tr>
                            </thead>
                            <tbody id="monthlyBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>

        <div class="sidebar">
            <button id="btnInventory">ðŸ“¦ Inventario</button>
            <button id="btnSales">ðŸ’° Ventas</button>
            <button id="btnSettings">âš™ Ajustes</button>
        </div>

        <footer></footer>

    </div>

    <script>
        // IPC Logic
        function sendMessage(action, data = null) {
            if (window.chrome && window.chrome.webview) {
                const message = { Action: action, Data: data };
                window.chrome.webview.postMessage(JSON.stringify(message));
            }
        }

        // Navigation
        document.getElementById('btnInventory').addEventListener('click', () => sendMessage('Inventario'));
        document.getElementById('btnSales').addEventListener('click', () => sendMessage('Ventas'));
        document.getElementById('btnSettings').addEventListener('click', () => sendMessage('Ajustes'));

        // Tabs
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');

            if (tabId === 'history') sendMessage('GetSalesHistory');
            if (tabId === 'zreport') sendMessage('GetDailyTotal');
            if (tabId === 'monthly') sendMessage('GetMonthlyTotal');
        }

        function calculateZ() {
            sendMessage('GetDailyTotal');
        }

        // Listen for data
        window.chrome.webview.addEventListener('message', event => {
            const msg = event.data;
            if (msg.Type === 'SalesHistory') renderHistory(msg.Data);
            if (msg.Type === 'DailyTotal') document.getElementById('dailyTotal').textContent = `$${msg.Data.toFixed(2)}`;
            if (msg.Type === 'MonthlyTotal') renderMonthly(msg.Data);
        });

        function renderHistory(sales) {
            const tbody = document.getElementById('historyBody');
            tbody.innerHTML = '';
            sales.forEach(s => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                <td>#${s.Id}</td>
                <td>${new Date(s.Fecha).toLocaleString()}</td>
                <td>$${s.Total.toFixed(2)}</td>
                <td>${s.ItemsCount}</td>
            `;
                tbody.appendChild(tr);
            });
        }

        function renderMonthly(data) {
            const tbody = document.getElementById('monthlyBody');
            tbody.innerHTML = '';
            data.forEach(d => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                <td>${d.Month}</td>
                <td>${d.Year}</td>
                <td>$${d.Total.toFixed(2)}</td>
            `;
                tbody.appendChild(tr);
            });
        }

        // Initial Load
        sendMessage('GetSalesHistory');
    </script>
</body>

</html>